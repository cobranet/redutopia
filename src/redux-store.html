<link rel="import" href="../bower_components/polymer-redux/polymer-redux.html">
<script src="reducers/search-reducer.js"></script>
<script src="reducers/site-reducer.js"></script>
<script src="utils.js"></script>
<script>
 
 const game = { names: ["Halebeard Peak" , "The Great Wilds", "Root Stranged Marshes", "Glassrock Canyon", "Ruined City", "The Fiery Maw"  ],
		images: [ "castle.png", "desert.png", "forest.png" , "island.png" , "swamp.png", "pole.png" ],
		constructs: [ "Seal of Balance", "Hermetic Mirror",  "Void Gate" , "Golden Chassis" , "Scrying Lens", "Crystal Battery"],
		components: ["Silver", "Quartz", "Gum", "Silica", "Wax", "Lead" ],
		treasures: ["Ice Plate", "Bracelet of Ios", "Shimmering Moonlice" , "Scale of Infinity Wurm", "The Ancient Record", "The Molten Shard" ],
		initialState: function () {
		    var i;
		    var site;
		    arr = [];
		    for (i=0;i<6;i++) {
			site = {};
			site.name = game.names[i];
			site.construct = game.constructs[i];
			site.component = game.components[i];
			site.imagename = game.images[i];
			site.treasure = game.treasures[i];
			site.placeid = i;
			site.active_search = 0;
			site.searches = [
			    {score: 0, boxes: ["","","","","",""] , searchid: 0 , insearch: 0,dices:[] },
			    {score: 0, boxes: ["","","","","",""] , searchid: 1 , insearch: 0,dices:[] },
			    {score: 0, boxes: ["","","","","",""] , searchid: 2 , insearch: 0,dices:[] },
			    {score: 0, boxes: ["","","","","",""] , searchid: 3 , insearch: 0,dices:[] },
			    {score: 0, boxes: ["","","","","",""] , searchid: 4 , insearch: 0,dices:[] },
			    {score: 0, boxes: ["","","","","",""] , searchid: 5 , insearch: 0,dices:[] }
			],
			arr.push(site);
		    }
		    return arr;
		}
 };
 const initalState = {
     sites: game.initialState(),
     active_site: 0
 }
 const reducer = function(state,action) {
     if(!state){
	 return initalState;
     }
     switch(action.type){
	 case "SELECT_SITE":
	     const sites = state.sites.slice(0);
	     const active_site= action.selectedSite;
	     var obj = Object.assign({},state,{sites: sites,active_site: active_site});
	     return obj;
	 case "TAP_CELL":
	     var active = state.active_site;
	     new_site = siteReducer(state.sites[active],action);
	     new_sites = reduxUtils.replaceItem(state.sites,state.active_site,new_site);
	     var obj = Object.assign({},state,{sites: new_sites});
	     return obj;
	 case "ROLL" :
	     var active = state.active_site;
	     new_site = siteReducer(state.sites[active],action);
	     new_sites = reduxUtils.replaceItem(state.sites,state.active_site,new_site);
	     var obj = Object.assign({},state,{sites: new_sites});
	     return obj;
	 case "SEARCH":
	     new_site = siteReducer(state.sites[active],action);
	     new_sites = reduxUtils.replaceItem(state.sites,state.active_site,new_site);
	     var obj = Object.assign({},state,{sites: new_sites});
	     return obj;
	     
     }
 };

 const store = Redux.createStore(reducer);
 const ReduxBehavior = PolymerRedux(store);
</script>
